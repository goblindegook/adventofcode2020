package com.goblindegook.adventofcode2020

import java.math.BigInteger

fun main() {
    println(treeCount(3, 1, input))

    println(
        listOf(
            treeCount(1, 1, input),
            treeCount(3, 1, input),
            treeCount(5, 1, input),
            treeCount(7, 1, input),
            treeCount(1, 2, input),
        ).map(Int::toBigInteger).reduce(BigInteger::times)
    )
}

fun treeCount(right: Int, down: Int, map: String): Int = treeCount(0, 0, 0, right, down, map)

private fun treeCount(answer: Int, x: Int, y: Int, right: Int, down: Int, map: String): Int =
    if (y <= map.height()) treeCount(
        answer + if (map.featureAt(x, y) == TREE) 1 else 0,
        x + right,
        y + down,
        right,
        down,
        map
    ) else answer

private const val NEW_LINE = '\n'
private const val TREE = '#'
private fun String.width() = indexOf(NEW_LINE)
private fun String.height() = count { it == NEW_LINE }
private fun String.featureAt(x: Int, y: Int) = get(y * (width() + 1) + (x % width()))

private val input = """
    ......#..........##......#.####
    .##...###....#.....#...#.#.....
    #..##..#.....#............#.#.#
    ##.#....#####..#....#..#.#.....
    ..#.#...##.##.......#.#..#..##.
    ##.#.......#.#.#..#...#.#...#..
    ...#...#..#.##....##..#.#......
    .......##.#.#.#.##...#.........
    ..#...##.##...##..##.##...#....
    .#.#...#.....####..#.#...#.##..
    .#...#......##......##....#....
    ..#.....#.........##.#...#.#...
    ...#.#...#..##...#....#.....##.
    ..#.....#..#..#......###.......
    ...##.#....##..##...........#..
    ....#......#..#....###...#.....
    .....#...#.#.....#..##........#
    ....#...#....##.#.##.#...#..#.#
    .......##.#......##....#....#..
    ...#.#...##..#...#..#..#..##.#.
    ##.#...#..#..................##
    ##........#....##...#..#..#....
    .#.#..............#######.##...
    ##..#..#.#.##..#...............
    ..#........#..#...##.......#...
    ............##.##.#..........##
    .....##..#.....##..#.....#.....
    ..#.##.###.#..##.............#.
    .........##...........#.....#..
    ..#....#.#.###.#.#.......##....
    ..###..##..#.#.##......#.#.##..
    ##......#.#....##.#..#.#..#.#.#
    ..##.#.###.#...#...............
    ..####.......#...#.##....#.....
    ..#....##...#.#.#.#....#.##..##
    .#...####..###....#.###...##...
    ..#.#..........#.#..#..#.....##
    .#....#.........###...#.....##.
    ..#.#.#.##........#.##.#.....#.
    #....#....###...#..#.........#.
    #..#.###....#..............#...
    ............#....##.#......#.#.
    ...#..#.####...............##..
    ....##......#.#.........####..#
    .#....###..#.#..##........##...
    #..##.....###..#...............
    ..#...........#........#...#..#
    ......................#.#..#...
    .#.##.#..#.#....#...#...#.#....
    ..#..#.........#..#.#..........
    .#......#####...#......#..#....
    ..........#.....#..#.##.####.##
    ##.##..#............#####...#.#
    ..##..#..###......#...#...#....
    ....#####........#.##...###....
    ......#...##..#..#............#
    ...#....##.##...#..#...#.......
    ....#####.#...............###..
    .#....#..##....#.#.#..##.##...#
    ...#..#..#........#.#####.....#
    ......##.#...#..#..#.....#..###
    ###.......#.#........#......#.#
    ..#.#..#..#........#..#......#.
    ...##.........#..........#.....
    ...#..###.#.......#.#.........#
    ....#..#.##...##.....#.....##..
    #.#.#.#.....##.##.###..#.#....#
    ..#....#.....##.####..#........
    ...#..#.##.....##.#..#....###..
    .#..#.....#....#...#.#.......##
    ..#..#.......#.#.###......#.##.
    .###.####....##............##.#
    #....###.#......##.#......##.#.
    .##...........#.#....#.........
    #.##..##...#...........###....#
    #.#..#...#.#..#..###.#.##...#..
    ..#...#.#..##....#..#..#.......
    #..##..#.####...#...#..####.##.
    ###..#.##....#...#.###..##...##
    ##..#..#.#....#.....##.......#.
    ..#..##.##.#.......###.#.....#.
    ..........#.####....#.......#..
    #...#.#..#.......##......##..##
    ##...##.##..###...............#
    ....##.#...#.......##...##..#..
    .#.........#...#.#...##.#.....#
    .#...#.#..#...#..##....#..#...#
    .#.#...#..#..###...##....#.....
    .........#.#...####..#...#.#...
    ...#.............#.#..........#
    ...#...#..##.#........#.#......
    ...#...#.....#....#..###.##.###
    .#.#........#....#...#.###.#.#.
    ##.....#.......#..##.#....#..##
    ...###...#.#.#.#....#.#....#...
    #...#.#.......##.#..#....#.#...
    #...#......###.....###........#
    ..#.##...##....#...#....#.#....
    #....#..###....##.#......##...#
    ##.#...#..........#.##....#..#.
    .##....#............###.#...#..
    ###.##.#####.##.....##..#####..
    ..###.###.......#.#...#....#...
    .#...#....####.........#.......
    ..##.#.#......#....#.#....#.#.#
    #.####.....#....#..#.....#.##..
    ###.###.##...##.#.#.#.....#.#..
    .......#.....#.......##.#.....#
    #..#.##...#........#.#.......##
    #.#........#...#....#..........
    ..#....##.#......#..#..........
    #....##.....#.....#.##.#...#...
    ....#.#.....#....####...#.#.##.
    ......#.......##...##.#......#.
    .#.........##...#..#..##..#....
    .#...##.....##.#....#..........
    ....#.###..##..#...#..........#
    ......#...#.#.#........##......
    .#..........#.#.....#..##..#.#.
    .......###.#......#....#.#..#..
    ..##.......#....#....#.#...##.#
    #.##.#.......#..###..##...#.#..
    ......####....#.#.....#...#..#.
    #.##.###..#..#.#.....###..#.#.#
    #.#.#..#.#..##...#...#..##.###.
    ....##..##.#...............#.#.
    ..###.#.#.##..#....##.......#..
    #.#....#..........##......#####
    .#.#.......##.#.#......##..#.#.
    ......#.###.##.#..#....#.##....
    ..###........#.......##.#.#....
    .#..##.............#.##.###...#
    .#####...#......#.......##.....
    ##..###.#...#....#..#....#.#..#
    .#.........###.##.....##.....##
    .##.#....#..#.#..##..#....##...
    .#..#..#......###...#.......#..
    #.#...#.....#..#.#.#..#..###...
    ....#....#..#..#....#..#.#.#...
    ......#.......#.#.#.#.....#....
    ###...#...#......#..#.#.#..#.#.
    #...##.##.##........##....#....
    .....#.......#...#...#.#.#....#
    ...##.....##.#...#.#.#.#..#..#.
    .#.......##...........#...#.##.
    .##..........#......#.#...###..
    .....##...#.....#...#......#...
    ...........#.....#..#...#..#.#.
    #.....##..#...........##....#..
    #.##...###.###....##..#..#....#
    #.#.##...##....###....##.##....
    .#..###.....#......#...#...#..#
    ..#...#....#.#.###.#..#......#.
    ......#.........#..#.##...#...#
    ..#.#....##.#..##..##...#....#.
    #.....#....##.........##.#.....
    ...#...#..###.###......##...###
    .##.###...##..#.##....##.#..#..
    ..#..#.......#................#
    .....#..#.#.#..........##..#...
    ......###.#.#............#..#.#
    ..#.##.....##....#...#...#.#...
    ..#......##...#...##........#..
    #.....#.....#..#......#.###...#
    ....#..#.#.....#...#....#.#...#
    #.......#..#...##..#.#..#.##...
    ..#......###...#.........##...#
    ...#.......##.....#..##........
    .#....#.#.....##.#.#...........
    ##..#..#...#.##.#.#.#.#.#..##.#
    ##...####.#.#.##...#..#......#.
    #.##..####.##.#.........#...###
    #...#.......#.#..####.#.#.#....
    #....#........#........#.......
    ..#..####.....#....##...###.##.
    ...#.#..####.........#....#.##.
    ##.#...#...#..#.#..##.....##...
    ....#.........#.##........##.#.
    ##...#......#....#..#....#....#
    ###.....#......##...#...##...#.
    #.##...............#.......#...
    .##.#...#..#....#.#.....###..#.
    .....##...#.##.....##...#....#.
    #.#..#..........#####..##......
    ..#.........##...#.........#.##
    ...#..##.#.#..#......#..###.###
    #..#...#.#...##..........#.....
    .###..#....###.....#....#..###.
    #..#....#...#........##.....#..
    .#..###........#....#..####..##
    .#..#.#.#.......##.#..##.#..##.
    ..#..###......##....#..#..#..#.
    .......###..##....#......#...##
    #........#.##.............##.#.
    ...#.#.#....##....##.###...#...
    ..#.....#..##..#.#.......#.####
    .#......##.........##...#.....#
    .#.###........##....###.#.#...#
    ##...#.#....#.....##.......#..#
    #...........#...........####...
    #..#.#..##..#...#....#.##....#.
    ................##.............
    ..##...#.#....##....#...#......
    .#.....#....#....#..#..#.#..##.
    .....######.#.#.##.###.#.......
    ..#####....#..#...........#.#..
    .......#..#..##.#...###.#.#.###
    ###...#...#..##.#.##..#...#..#.
    .#..#..............#...........
    .#.....#.....##....#....##..#..
    ....#####.#....#......#.......#
    .#.#.....##.####..#...#.......#
    .#...##.#.......#.....##.#..##.
    ..........#...#....###....#...#
    ..#......#...#...#..#.#........
    .......#.......#..####..##.....
    .#..#.....###...#...#...#...#..
    ##..#.......#.#...#..#..#.##..#
    #..#...#.#.....#.##.#........#.
    ......#......#.#..###.##..###..
    .#..#..#.##.#...........#...##.
    .#....#...#.#..#.#.#...##.#..#.
    ##.#....#..#..#.#...#......#.#.
    ..#.#............##...#........
    ...####...#...#.....##..#...###
    ....###.......###.##..#.###....
    #......#.#....#.#.##.#.##..###.
    .....##.....#..##.....##....#..
    ..#...#..##.#.##.#.#.#.......##
    #....#..##.......#......#..#.##
    #.....##...#..##......##.#.#..#
    ....#..##..#.##...#.#.##..#..##
    #..#...##....##..#...#....#...#
    .##.#.#....#.....#........##.#.
    ..##..#....#........#.....#....
    .##.#..##...#.....#...###.....#
    #..#..#........#..#.....#.#.#.#
    ..##..###.#..#...#.#......#..#.
    #.....#.....#.###......##..#.#.
    .........#...##.........#...#..
    .##.#.##......#.#...###..#....#
    ...##.#..###........##......#..
    ...#.#...#......#.#.#....#..#..
    ..####.........#..#....#.......
    #..#.........##.#.##....#.....#
    ..#..#..#.#........#.###.......
    ##.#..#..#....#...##.......#..#
    ..#.#.....#.............#...##.
    ..........#...##.....#..#.#..#.
    ....#..#...#..##..#...##.#.....
    ##....#......#..#.....#..#.....
    ...#.#.#.#...........##...#.#..
    ....#.###...#............#.....
    .#.#.#.......#.#......#....#.#.
    #.#.#.#..##.#..#..##...##.#..#.
    .#.##....##..#........#....#...
    ####...#....#.#...#..#..###...#
    .....#.#.##.......##..#.######.
    .......#.#.#.....#.#..##....#..
    ..#....#.#..#.#.#..#..#........
    .....##......#.........#.#...##
    #....##.#.....#..........#.#...
    #...#.#..#.#..#.#....#..#.#....
    ....##........#................
    ###.#.#...#..##...#...#.##...#.
    ...#....###..#..##..#..#.......
    .....#..........#.#........##.#
    .#........#.##.#..##..#...#...#
    ..##....#...#.#.........##.#...
    ......#...#......#.....#.......
    ....##.##..#.##...#.#.#.##.#.#.
    ..#...#.....#.#....##.#........
    .#.#.......#.......###..#..#...
    #...#..#..#..##....#...#.....#.
    .#..####.##.....##.........#.#.
    #...###.......#...####..##.....
    #.##.#....#.#.##.......#...#...
    ..#.......#.#.##.##..#...##....
    .#.......#.#..#.....#.....#.#..
    ..#..#.......##.....#.#.....#.#
    #...###..#..#..##...#.....#..##
    ......#................#.......
    ..#.....##..#.......#...#...##.
    ...##...####.#..#...#.......##.
    ..#...#..#...#...#..#..#####...
    #..#...#....#....#...........#.
    ..#.......#..#.##...##..###...#
    .#..#..#......##...#....#......
    ...#..##....#..........#.....#.
    ###...#.#......#.#.....#.....##
    #.#..#.....#........#.##.#.##..
    ....#...#.....#..#.......#.#...
    #.#...##....#..#.....#...#.#.#.
    .#......#...##..#.......#......
    ...#...#.#.#.###.#..#.#..#.....
    ###...#..###.#...#..##...####..
    .#.#.#..#........#..#......#..#
    .#..#....#......#....#.#...#...
    .##..........###...##.....#.#..
    .#...#.#.##.##..###.#...#..###.
    ......#......#......#.##......#
    ..#.##..#.#..#....##..##...#...
    .#......#..#...##....#...#.....
    .#.....#.##..........#..#......
    ###.#..#.##..#..##...#..#...#..
    #.....###........#.#..##.#.....
    .....#.......##.....##.....#.##
    ...##.#......####....##........
    ..#..#..#....#.##.....##.####..
    ...#..#....#.#..#.#..#.#.#..#..
    #..........#....#.#.#.#...#..#.
    ...####.##...#..#.......#.#..##
    #........#..#..................
    .#..#....#.#.#..#..........#...
    ###...#....####....#......#..#.
    #.........####..#..#...........
    .....##..#..##.##.##.#..#.....#
    .#..#.#.##..#..#.#.#.##.###....
    ......##......#...#.##....#..#.
    .#.#....#..#......#..#...###...
    .##...#......##...###...#.#...#
    .......#.#....#............#..#
    .#..##.#.######...#...#......#.
""".trimIndent()